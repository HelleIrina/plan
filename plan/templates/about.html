{% extends "base_site.html" %}
{% load translation %}
{% load compressed %}
{% load json %}
{% load color %}

{% block title %}
    {% trans "About the Timetable generator for NTNU students" %}
{% endblock %}

{% block hd %}
    <h1>{% trans "About the Timetable generator for NTNU students" %}</h1>
{% endblock %}

{% block bd %}
    <div id="graph">
    </div>
{% endblock %}

{% block extrascript %}
    <!--[if IE]><script language="javascript" type="text/javascript" src="{{ MEDIA_URL }}js/excanvas.min.js"></script><![endif]-->

    {% compressed_js 'graph' %}

    <script type="text/javascript">
        $(document).ready(function() {
            var fills = [];
            {% for a in stats %}
            fills.push("{% color forloop.counter %}");{% endfor %}

            var stats = {{ stats|json }};
            var max_x = 0;
            var series = [];
            var options = {
                xaxis: { mode: "time" },
                yaxais: { min: 0 },
            };
            var color = "#333";

            for (var i = 0; i < stats.length; i++) {
                var x = stats[i][0][0]*1000 - 60*60*24*1000;
                var y = 0;
                var data = [[x, y]];
                var fill = $.color.parse(fills[i]).scale('a', 0.5);
                var lines = {
                    show: true,
                    lineWidth: 1,
                    fill: true,
                    fillColor: fill.toString(),
                }

                for (var j = 0; j < stats[i].length; j++) {
                    x  = stats[i][j][0] * 1000;
                    y += stats[i][j][1];

                    data .push([x, y]);
                    max_x = x > max_x ? x : max_x;
                }
                series.push({data: data, lines: lines, color: color.toString()});
            }

            for (var i = 0; i < series.length; i++) {
                series[i].data.push([max_x, series[i].data[series[i].data.length-1][1]]);
            }

            $.plot($('#graph'), series, options);
        });
    </script>
{% endblock %}
