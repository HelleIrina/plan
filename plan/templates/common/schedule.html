{% extends "base.html" %}

{% block title %}
    {{ slug }}'{% ifnotequal slug|lower|slice:"-1:" "s" %}s{% endifnotequal %} {{ semester.get_type_display }} {{ semester.year }} {{ block.super }}
{% endblock %}

{% block hd %}
    <h1>{{ slug }}'{% ifnotequal slug|lower|slice:"-1:" "s" %}s{% endifnotequal %}  {{ semester.get_type_display }} {{ semester.year }} schedule</h1>
{% endblock %}

{% block bd %}
<table class="schedule">
    <thead>
        <tr>
            <th class="time"></th>
            <th colspan="{{ colspan.0 }}">Monday</th>
            <th colspan="{{ colspan.1 }}">Tuesday</th>
            <th colspan="{{ colspan.2 }}">Wednesday</th>
            <th colspan="{{ colspan.3 }}">Thursday</th>
            <th colspan="{{ colspan.4 }}">Friday</th>
        </tr>
    </thead>
    <tbody>
    {% for row in table %}
        <tr class="{% cycle odd,even %}{% if forloop.last %} bottom{% endif %}">
            {% for cells in row %}
                {% if cells %}
                    {% for c in cells %}
                        {% if not c.remove %}
                            <td colspan="{{ c.colspan|default:"1" }}"
                                rowspan="{{ c.rowspan|default:"1" }}"
                                {% if c.class or forloop.first %}class="{% if forloop.first %}first{% else %}extra{% endif %} {{ c.class }}"{% endif %}
                                {% if c.lecture %}title="{{ c.lecture.course.full_name }}"{% endif %}>

                                {% if c.lecture %}
                                    <div class="course">{{ c.lecture.course }}</div>
                                    <div class="room">{% for r in c.lecture.sql_rooms %}{{ r }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
                                    <div class="type">{% if c.lecture.type_id %}{{ c.lecture.type }}{% endif %}</div>
                                {% endif %}
                                {% if c.time %}
                                    {{ c.time }}
                                {% endif %}
                            </td>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <td></td>
                {% endif %}
            {% endfor %}
        </tr>
    {% endfor %}

    </tbody>
</table>

<p class="noprint">
    <a href="{% url course-list semester.year,semester.get_type_display,slug %}">
        <img alt="" src="{{ MEDIA_URL }}gfx/list.png" />Course list</a>
    {% if legend %}
        {% if advanced %}
            - <a href="{% url schedule semester.year,semester.get_type_display,slug %}">
                <img alt="" src="{{ MEDIA_URL }}gfx/advanced.png" />Hide advanced options</a>
        {% else %}
            - <a href="{% url schedule-advanced semester.year,semester.get_type_display,slug %}">
                <img alt="" src="{{ MEDIA_URL }}gfx/advanced.png" />Advanced options</a>
        {% endif %}
    {% endif %}
    - <a href="#tips"><img alt="" src="{{ MEDIA_URL }}gfx/tips.png" />Tips</a>
</p>

<div class="yui-g">
    <div class="yui-u first">
        <form action="{% url change-course semester.year,semester.get_type_display,slug %}" method="post">
            <h2>Courses</h2>
            {% if legend %}
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Credits</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for course in legend %}
                            <tr class="{{ course.css_class }}" title="{{ course.full_name }}">
                                <td>
                                    <input type="checkbox" name="course_remove" value="{{ course.id }}" class="noprint" />
                                </td>
                                <td>
                                    {% if course.url %}
                                        <a href="{{ course.get_url }}">
                                            {{ course }}
                                        </a>
                                    {% else %}
                                        {{ course }}
                                    {% endif %}
                                </td>
                                <td>
                                    {{ course.full_name }}
                                </td>
                                <td class="number">
                                    {{ course.points|default:""|floatformat:"1" }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}

            <p class="noprint">
                <input id="course" type="text" name="course_add" size="20"/>
                <button name="submit_add" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/add.png" /> Add courses</button>
                {% if legend %}
                    <button name="submit_remove" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/remove.png" /> Remove selected</button>
                {% endif %}
            </p>
        </form>
        {% if exams %}
            <h2>Exams</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Dur.</th>
                        <th>Type</th>
                        <th>Course</th>
                        <th>Comment</th>
                        <th>Handout time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exam in exams %}
                        <tr class="{{ exam.css_class }}" title="{{ exam.course.full_name }}">
                            <td>
                                {{ exam.exam_date }}
                            </td>
                            <td>
                                {% if exam.exam_time %}
                                    {{ exam.exam_time|time:"H:i" }}
                                {% endif %}
                            </td>
                            <td class="center">{{ exam.duration|default:"-" }}</td>
                            <td>
                                {% if exam.type_name %}
                                    {{ exam.type_name }}
                                {% else %}
                                    {{ exam.type }}
                                {% endif %}
                            </td>
                            <td>{{ exam.course.name }}</td>
                            <td>{{ exam.course.comment|default:"-" }}</td>
                            <td>
                                {% if not exam.handout_date %}
                                    -
                                {% else %}
                                    {{ exam.handout_date }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <ul class="noprint small">
                <li>
                    Please check that exams are listed at
                    <a href="http://www.ntnu.no/eksamen/plan/">http://www.ntnu.no/eksamen/plan/</a>
                    before complaining about them missing from your overview.
                </li>
                <li>
                    Handout time usually only applies to home exams where some material
                    is given out some time before a delivery date.
                </li>
            </ul>
        {% endif %}
    </div>
    <div class="yui-u">
        <h2>Deadlines</h2>
        <form method="post" action="{% url change-tasks semester.year,semester.get_type_display,slug %}">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Course</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Task</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in deadlines %}
                        <tr class="{{ d.css_class }}">
                            <td><input type="checkbox" name="deadline_remove" value="{{ d.id }}" /></td>
                            <td>{{ d.userset }}</td>
                            <td style="padding-left:1em">{{ d.date }}</td>
                            <td style="padding-left:1em">{{ d.time|time:"H:i" }}</td>
                            <td style="padding-left:1em">{{ d.task }}</td>
                        </tr>
                    {% endfor %}
                    {% if deadline_form.errors %}
                        <tr>
                            <td colspan="5">
                                <dl class="error">
                                    {% if deadline_form.errors.userset %}
                                        <dt>Course:</dt> <dd>{{ deadline_form.errors.userset.as_text|slice:"1:" }}</dd>
                                    {% endif %}
                                    {% if deadline_form.errors.date %}
                                        <dt>Date:</dt>  <dd>{{ deadline_form.errors.date.as_text|slice:"1:" }}</dd>
                                    {% endif %}
                                    {% if deadline_form.errors.time %}
                                        <dt>Time:</dt> <dd>{{ deadline_form.errors.time.as_text|slice:"1:" }}</dd>
                                    {% endif %}
                                    {% if deadline_form.errors.task %}
                                        <dt>Task:</dt> <dd>{{ deadline_form.errors.task.as_text|slice:"1:" }}</dd>
                                    {% endif %}
                                </dl>
                            </td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td colspan="2">{{ deadline_form.userset }}</td>
                        <td>{{ deadline_form.date }}</td>
                        <td>{{ deadline_form.time }}</td>
                        <td>{{ deadline_form.task }}</td>
                    </tr>
                </tbody>
            </table>
            <p>
                <button name="submit_add" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/add.png" /> Add task</button>
                {% if deadlines %}
                    <button name="submit_remove" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/remove.png" /> Remove selected</button>
                {% endif %}
            </p>
        </form>
    </div>
</div>

{% if advanced %}
    {% if courses %}
        <h2 class="noprint">Change groups</h2>
        <p class="noprint">
            Each lecture is connected to one or more groups, please select
            which group's lectures you want to attend. To select more than
            one group press <code>CTRL</code> and the groups you want.
        </p>
        <form action="{% url change-groups semester.year,semester.get_type_display,slug %}" method="post">
            <div class="yui-g noprint">
                {% for course,groups in courses %}
                    <p class="{{ course.css_class }} legend left box" title="{{ course.full_name }}">
                        <b>{{ course }}</b> <br />
                        <span class="small">{{ course.full_name|truncatewords:"3" }}</span> <br />
                        {{ groups.groups }}
                    </p>
                {% endfor %}
            </div>
            <p class="noprint">
                <button type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/save.png" /> Save groups</button>
            </p>
        </form>
    {% endif %}
    {% if lectures %}
        <h2>Lecture list</h2>
        <p>
            If your schedule contains lectures you don't want to be shown
            please select them here and choose «Hide selected lectures».
        </p>
        <form action="{% url change-lectures semester.year,semester.get_type_display,slug %}" method="post">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Course</th>
                        <th>Day</th>
                        <th>Time</th>
                        <th>Rooms</th>
                        <th>Type</th>
                        <th>Groups</th>
                        <th>Lecturers</th>
                        <th>Weeks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for l in lectures %}
                        <tr class="{{ l.css_class }}{% if l.excluded %} excluded{% endif %}">
                            <td><input type="checkbox" name="exclude" value="{{ l.id }}"{% if l.excluded %} checked="checked"{% endif %} class="noprint" /></td>
                            <td>{{ l.course }}</td>
                            <td>{{ l.get_day_display }}</td>
                            <td>{{ l.get_start_time_display }}-{{ l.get_end_time_display }}</td>
                            <td class="small">{% for r in l.sql_rooms %}{{ r }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
                            <td class="small">{% if l.type_id %}{{ l.type }}{% endif %}</td>
                            <td class="small">{% for g in  l.sql_groups %}{{ g }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                            <td>{% for p in  l.sql_lecturers %}{{ p }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                            <td class="small">{% for w in  l.sql_weeks %}{{ w }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p class="noprint">
                <button type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/hide.png" /> Hide selected lectures</button>
            </p>
        </form>
    {% endif %}
{% endif %}

<h2 id="tips">Tips</h2>
<div class="yui-g">
    <div class="yui-u first">
        <p style="background: url({{ MEDIA_URL }}gfx/add.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            Multiple courses can be added at once by separating course codes with spaces.
        </p>
        <p style="background: url({{ MEDIA_URL }}gfx/link.png) no-repeat top left; padding-left: 20px; min-height: 20px">
             For quick access to your schedule simply go to
            <a href="{% url shortcut slug %}">http://{{ request.META.HTTP_HOST }}{% url shortcut slug %}</a>
        </p>
        <p style="background: url({{ MEDIA_URL }}gfx/hide.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            Did you know that you can choose to hide lectures that you don't want to be shown under <a href="{% url schedule-advanced semester.year,semester.get_type_display,slug %}">adavanced options</a>.
        </p>
        <p style="background: url({{ MEDIA_URL }}gfx/save.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            Did you know that you can select which groups (paralleller) you want to attend, and than you can select more that one group.
        </p>
    </div>
    <div class="yui-u">
        <p style="background: url({{ MEDIA_URL }}gfx/list.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            The <a href="{% url course-list semester.year,semester.get_type_display,slug %}">course list</a>
            contains all courses for the current semester, including exam dates and
            allows you to easily select courses to add to your schedule.
        </p>
        <p style="background: url({{ MEDIA_URL }}gfx/ical.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            Calendar export:
            <a href="{% url schedule-ical-lectures semester.year,semester.get_type_display,slug %}">lectures</a>,
            <a href="{% url schedule-ical-exams semester.year,semester.get_type_display,slug %}">exams</a> or
            <a href="{% url schedule-ical semester.year,semester.get_type_display,slug %}">both combined</a>.
            <br />
            Simply download or copy the link to the calendar you want and add it to any application that supports the Ical format.
        </p>
        <p style="background: url({{ MEDIA_URL }}gfx/gcal.png) no-repeat top left; padding-left: 20px; min-height: 20px">
            Google calendar:
            <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical-lectures semester.year,semester.get_type_display,slug %}">lectures</a>,
            <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical-exams semester.year,semester.get_type_display,slug %}">exams</a> or
            <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical semester.year,semester.get_type_display,slug %}">both combined</a>.
            <br />
            Simply click the calendar type you want and it will be added to Google calendar.
        </p>
    </div>
</div>

{% endblock %}
