{% extends "base.html" %}

{% block title %}
    {{ slug }}'{% ifnotequal slug|lower|slice:"-1:" "s" %}s{% endifnotequal %} {{ semester.get_type_display }} {{ semester.year }} {{ block.super }}
{% endblock %}

{% block hd %}
    <h1>{{ slug }}'{% ifnotequal slug|lower|slice:"-1:" "s" %}s{% endifnotequal %}  {{ semester.get_type_display }} {{ semester.year }} schedule</h1>
{% endblock %}

{% block bd %}

<table class="schedule">
    <thead>
        <tr>
            <th class="time"></th>
            <th colspan="{{ colspan.0 }}">Monday</th>
            <th colspan="{{ colspan.1 }}">Tuesday</th>
            <th colspan="{{ colspan.2 }}">Wednesday</th>
            <th colspan="{{ colspan.3 }}">Thursday</th>
            <th colspan="{{ colspan.4 }}">Friday</th>
        </tr>
    </thead>
    <tbody>
    {% for row in table %}
        <tr class="{% cycle odd,even %}{% if forloop.last %} bottom{% endif %}">
            {% for cells in row %}
                {% if cells %}
                    {% for c in cells %}
                        {% if not c.remove %}
                            <td colspan="{{ c.colspan|default:"1" }}"
                                rowspan="{{ c.rowspan|default:"1" }}"
                                {% if c.class or forloop.first %}class="{% if forloop.first %}first{% else %}extra{% endif %} {{ c.class }}"{% endif %}
                                {% if c.lecture %}title="{{ c.lecture.course.full_name }}"{% endif %}>

                                {% if c.lecture %}
                                    <div class="course">{{ c.lecture.course }}</div>
                                    <div class="room">{% for r in c.lecture.sql_rooms %}{{ r }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
                                    <div class="type">{% if c.lecture.type_id %}{{ c.lecture.type }}{% endif %}</div>
                                {% endif %}
                                {% if c.time %}
                                    {{ c.time }}
                                {% endif %}
                            </td>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <td></td>
                {% endif %}
            {% endfor %}
        </tr>
    {% endfor %}

    </tbody>
</table>

<p class="noprint">
        <a href="{% url course-list semester.year,semester.get_type_display,slug %}">
            <img alt="" src="{{ MEDIA_URL }}gfx/list.png" />Course list</a>
    {% if legend %}
        {% if advanced %}
            - <a href="{% url schedule semester.year,semester.get_type_display,slug %}">
                <img alt="" src="{{ MEDIA_URL }}gfx/advanced.png" />Hide advanced options</a>
        {% else %}
            - <a href="{% url schedule-advanced semester.year,semester.get_type_display,slug %}">
                <img alt="" src="{{ MEDIA_URL }}gfx/advanced.png" />Advanced options</a>
        {% endif %}
        -
        <img alt="" src="{{ MEDIA_URL }}gfx/ical.png" />
        Calendar export:
        <a href="{% url schedule-ical-lectures semester.year,semester.get_type_display,slug %}">lectures</a>,
        <a href="{% url schedule-ical-exams semester.year,semester.get_type_display,slug %}">exams</a> or
        <a href="{% url schedule-ical semester.year,semester.get_type_display,slug %}">both combined</a>.
        <img alt="" src="{{ MEDIA_URL }}gfx/gcal.png" />
        Google calendar:
        <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical-lectures semester.year,semester.get_type_display,slug %}">lectures</a>,
        <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical-exams semester.year,semester.get_type_display,slug %}">exams</a> or
        <a target="_blank" href="http://www.google.com/calendar/render?cid=http://{{ request.META.HTTP_HOST }}{% url schedule-ical semester.year,semester.get_type_display,slug %}">both combined</a>.
    {% endif %}
</p>

<div class="yui-g">
    <div class="yui-u first">
        <form action="{% url change-course semester.year,semester.get_type_display,slug %}" method="post">
            <h2>Courses</h2>
            {% if legend %}
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Credits</th>
                        <tr>
                    </thead>
                    <tbody>
                        {% for course in legend %}
                            <tr class="{{ course.css_class }}" title="{{ course.full_name }}">
                                <td>
                                    <input type="checkbox" name="course_remove" value="{{ course.id }}" class="noprint" />
                                </td>
                                <td>
                                    {% if course.url %}
                                        <a href="{{ course.get_url }}">
                                            {{ course }}
                                        </a>
                                    {% else %}
                                        {{ course }}
                                    {% endif %}
                                </td>
                                <td>
                                    {{ course.full_name }}
                                </td>
                                <td class="number">
                                    {{ course.points|default:""|floatformat:"1" }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}

            <p class="noprint">
                <input id="course" type="text" name="course_add" size="20"/>
                <button name="submit_add" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/add.png" /> Add courses</button>
                {% if legend %}
                    <button name="submit_remove" type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/remove.png" /> Remove selected</button>
                {% endif %}
                <br />
                (Multiple courses can be added at once by separating course codes with spaces)
            </p>
        </form>
    </div>
    <div class="yui-u">
        {% if exams %}
            <h2>Exams</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Dur.</th>
                        <th>Type</th>
                        <th>Course</th>
                        <th>Comment</th>
                        <th>Handout time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exam in exams %}
                        <tr class="{{ exam.css_class }}" title="{{ exam.course.full_name }}">
                            <td>
                                {{ exam.exam_date }}
                            </td>
                            <td>
                                {% if exam.exam_time %}
                                    {{ exam.exam_time|time:"H:i" }}
                                {% endif %}
                            </td>
                            <td class="center">{{ exam.duration|default:"-" }}</td>
                            <td class="center">{{ exam.type }}</td>
                            <td>{{ exam.course.name }}</td>
                            <td>{{ exam.course.comment|default:"-" }}</td>
                            <td>
                                {% if not exam.handout_date %}
                                    -
                                {% else %}
                                    {{ exam.handout_date }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <ul class="noprint small">
                <li>
                    Please check that exams are listed at
                    <a href="http://www.ntnu.no/eksamen/plan/">http://www.ntnu.no/eksamen/plan/</a>
                    before complaining about them missing from your overview.
                </li>
                <li>
                    Handout time usually only applies to home exams where some material
                    is given out some time before a delivery date.
                </li>
            </ul>
        {% endif %}
    </div>
</div>

{% if advanced %}
    {% if courses %}
        <h2 class="noprint">Change groups</h2>
        <p class="noprint">
            Each lecture is connected to one or more groups, please select
            which group's lectures you want to attend. To select more than
            one group press <code>CTRL</code> and the groups you want.
        </p>
        <form action="{% url change-groups semester.year,semester.get_type_display,slug %}" method="post">
            <div class="yui-g noprint">
                {% for course,groups in courses %}
                    <p class="{{ course.css_class }} legend left box" title="{{ course.full_name }}">
                        <b>{{ course }}</b> <br />
                        <span class="small">{{ course.full_name|truncatewords:"3" }}</span> <br />
                        {{ groups.groups }}
                    </p>
                {% endfor %}
            </div>
            <p class="noprint">
                <button type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/save.png" /> Save groups</button>
            </p>
        </form>
    {% endif %}
    {% if lectures %}
        <h2>Lecture list</h2>
        <p>
            If your schedule contains lectures you don't want to attend please
            select them here and choose «Hide selected lectures».
        </p>
        <form action="{% url change-lectures semester.year,semester.get_type_display,slug %}" method="post">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Course</th>
                        <th>Day</th>
                        <th>Time</th>
                        <th>Rooms</th>
                        <th>Type</th>
                        <th>Groups</th>
                        <th>Lecturers</th>
                        <th>Weeks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for l in lectures %}
                        <tr class="{{ l.css_class }}{% if l.excluded %} excluded{% endif %}">
                            <td><input type="checkbox" name="exclude" value="{{ l.id }}"{% if l.excluded %} checked="checked"{% endif %} class="noprint" /></td>
                            <td>{{ l.course }}</td>
                            <td>{{ l.get_day_display }}</td>
                            <td>{{ l.get_start_time_display }}-{{ l.get_end_time_display }}</td>
                            <td class="small">{% for r in l.sql_rooms %}{{ r }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
                            <td class="small">{% if l.type_id %}{{ l.type }}{% endif %}</td>
                            <td class="small">{% for g in  l.sql_groups %}{{ g }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                            <td>{% for p in  l.sql_lecturers %}{{ p }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                            <td class="small">{% for w in  l.sql_weeks %}{{ w }}{% if not forloop.last %},{% endif %} {% endfor %}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p class="noprint">
                <button type="submit"><img alt="" src="{{ MEDIA_URL }}gfx/hide.png" /> Hide selected lectures</button>
            </p>
        </form>
    {% endif %}
{% endif %}

{% endblock %}
